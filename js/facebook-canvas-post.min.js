/* Combined sources:

- Coursera course: Creative Programming for Digital Media & Mobile Apps
- https://gist.github.com/andyburke/1498758 (the postImageToFacebook function)
- https://coderwall.com/p/4qpmfw

*/

// Source: https://gist.github.com/andyburke/1498758

// This bit is important.  It detects/adds XMLHttpRequest.sendAsBinary.  Without this
// you cannot send image data as part of a multipart/form-data encoded request from
// Javascript.  This implementation depends on Uint8Array, so if the browser doesn't
// support either XMLHttpRequest.sendAsBinary or Uint8Array, then you will need to
// find yet another way to implement this.

// from: http://stackoverflow.com/a/5303242/945521

function postImageToFacebook(e,t,n,r,i){var s="----ThisIsTheBoundary1234567890";var o="--"+s+"\r\n";o+='Content-Disposition: form-data; name="source"; filename="'+t+'"\r\n';o+="Content-Type: "+n+"\r\n\r\n";for(var u=0;u<r.length;++u){o+=String.fromCharCode(r[u]&255)}o+="\r\n";o+="--"+s+"\r\n";o+='Content-Disposition: form-data; name="message"\r\n\r\n';o+=i+"\r\n";o+="--"+s+"--\r\n";var a=new XMLHttpRequest;a.open("POST","https://graph.facebook.com/me/photos?access_token="+e,true);a.onload=a.onerror=function(){};a.setRequestHeader("Content-Type","multipart/form-data; boundary="+s);a.sendAsBinary(o)}function postCanvasToFacebook(e,t,n){var r=e.substring(e.indexOf(",")+1,e.length);var i=Base64Binary.decode(r);var s="generated_image";FB.login(function(e){if(e.authResponse){postImageToFacebook(FB.getAuthResponse()["accessToken"],s,"image/png",i,t);if(n){n()}}else{alert("user login problem!")}},{scope:"publish_stream"})}if(XMLHttpRequest.prototype.sendAsBinary===undefined){XMLHttpRequest.prototype.sendAsBinary=function(e){var t=Array.prototype.map.call(e,function(e){return e.charCodeAt(0)&255});this.send((new Uint8Array(t)).buffer)}}